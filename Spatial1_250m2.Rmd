---
title: "Spatial1_250m2"
output: html_document
date: "2023-09-18"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---
title: "Spatial1_MBRA_MMYS_16m2"
output: html_document
date: "2023-09-13"
---
# Background 
Spatial analysis of a population of Myotis brandtii (MBRA) and Myotis mystacinus (MMYS) from observations collected during radiotelemetry surveys in Nittedal in 2018. I will use a resource selection funcion (RSF) to compare how bats occupied different types of habitat described using LiDAR data. 


# Objectives 
- Generate a dataset of observed bat foraging locations and potential alternative random foraging locations for the RSF

- RSF with 250 m2 resolution LiDAR data



## Prepare work space, import and format the bat observation data 

```{r}

### Prepare the work space
library(tidyverse)
library(sp)
library(sf)
library(rgeos)
library(adehabitatMA)
library(digest)
library(mime)
library(jsonlite)
library(crs)
library(dplyr)
library(adehabitatHR)
library(Rcpp)
library(raster)
library(rgdal)
library(munsell)
library(tibble)
library(pillar)
library(ggplot2)
library(ResourceSelection)
library(mapview)
library(amt)
library(sjPlot)
library(Rgb)
library(nloptr)
library(colorspace)
library(rlang)
library(lattice)
library(MASS)
library(dismo)
library(scales)
library(rJava)
library(beepr)
library(OpenStreetMap)
library(lubridate)

getwd()
# "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/Documents/1. PhD_Main/GitHub_link/Nittedal/SpatialAndMorphology_MBRA_MMYS"

output <- "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Outputs"

file.name <- "Spatialpt1_250m"

todays_date <- Sys.Date()
 
dir.name <- str_c(output,"/", file.name, "_", todays_date)
dir.name
 
output_today <- dir.name
output_today

dir.create(output_today)
output_today



# Import the "onsite" observations of bats 
Bats45 <- read_delim("C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Spatial and Morphology/Inputs/45%.csv",     
                     delim = ";", escape_double = FALSE, trim_ws = TRUE)



str(Bats45)
dim(Bats45)
#1502 obs of 8 vars 
names(Bats45)
#[1] "Date"     "Time"     "BatID"    "Easting"  "Northing" "BD"       "Dir.obs"  "Gain"     

## Add column for species ID ##
mystacinus<- Bats45$BatID %in% c("Amelia","Marie", "Turid", "Reeda", "Daisy", "Line", "Stine", "Ethel", "Ragnhild", "Ida", "Louise", "Aricia")

Bats45$Species<-ifelse(mystacinus == TRUE, "MYSTACINUS", "BRANDTII")
Bats45$Species<- as.factor(Bats45$Species)

## Rename the Dir Obs column to replace the space with a period 
Bats45 <- Bats45 %>% rename(Dir.obs = "Dir obs")

## Factorize bat ID column as well 
Bats45$BatID <- as.factor(Bats45$BatID)

summary(Bats45$BatID)
#Amelia   Aricia   Astrid    Dagny    Daisy    Ethel      Ida     Kaja     Line   Louise    Maren    Marie     Nora   Phoebe Ragnhild    Reeda 
#16       90       81       83      134      117      119       91       55       64      141       31       49       62       28       70 
#Sofia   Steffi    Stine     Thea    Turid 
#39       39       84      101        8 

##The number of onsite plots per individual bat 

table(Bats45$Dir.obs, Bats45$BatID)
#Yes = onsite plots


M.mystacinus <- subset(Bats45, Species == "MYSTACINUS")
M.brandtii <- subset(Bats45, Species == "BRANDTII")

par(mfrow=c(2,1))
plot(table(M.mystacinus$BatID), main = "Number of plots Mmys", xaxt = "n")
plot(table(M.brandtii$BatID), main = "Number of plots Mbra")

#Fix date/time

names(Bats45)[1:2]<-c("date.cap","time.cap")

Bats45$date.cap<-as.character(Bats45$date.cap)

Bats45$time.cap<-as.character(Bats45$time.cap)

#---note: looks like many records are missing date and time data (this is rectified further down in the script)

Bats45$datetime<-paste(Bats45$date.cap,Bats45$time.cap)

head(Bats45$datetime)

# slightly different approach to dateime than in previous analyses
Bats45$datetime.posix<- as_datetime(Bats45$datetime,format = "%d.%m.%Y %H:%M:%S", tz="CET")
summary(Bats45)


summary(Bats45$Species)
  # BRANDTII MYSTACINUS 
  #      686        816 

summary(Bats45$Dir.obs=="Yes"|Bats45$BD=="Yes")
## Observations when the bats were detected by a handheld heterodyne while tracking 
#   Mode   FALSE    TRUE 
# logical     772     730 

summary(Bats45$Dir.obs=="Yes") # Observations where the bat was seen 
#   Mode   FALSE    TRUE 
# logical    1040     462

summary(Bats45$BD=="Yes") # Observations where the bat was picked up by a handheld heterodyne 
#    Mode   FALSE    TRUE 
# logical     820     682 


```

*CONSIDER* adding the roost sites of these bats into their locations before this next step to have a more complete home range estimate. 

## Create spatial data frame

```{r}

coords <- coordinates(Bats45)<-Bats45[,c("Easting","Northing")]
#assigning coordinates 

proj4string(Bats45)<-"+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs"
#Define the projection 
crs(Bats45)

Bats45<-Bats45[!is.na(Bats45$Easting) | !is.na(Bats45$Northing),]
#Remove NA values  - There were none to remove 

#Run again to get per species datasets without NA's 
Mystacinus <- subset(Bats45, Species == "MYSTACINUS")
Brandtii <- subset(Bats45, Species == "BRANDTII")


###########################################################################################
######################      Import Raster Data (LiDAR) ####################################
###########################################################################################


#The variables are explained here:
#https://github.com/Jean-Romain/lidR/wiki/stdmetrics

##---------- 250 m2 
#removeTmpFiles()
stack.r250<- stack("C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Spatial and Morphology/Inputs/stdmetrics_z.grd")
## Heavy file, this can take a moment 
beep() 

object16<- stack.r16
names(object16) 
#  [1] "zmax"         "zmean"        "zsd"          "zskew"        "zkurt"        "zentropy"     "pzabovezmean"
#  [8] "pzabove0.5"   "zq5"          "zq10"         "zq15"         "zq20"         "zq25"         "zq30"        
# [15] "zq35"         "zq40"         "zq45"         "zq50"         "zq55"         "zq60"         "zq65"        
# [22] "zq70"         "zq75"         "zq80"         "zq85"         "zq90"         "zq95"         "zpcum1"      
# [29] "zpcum2"       "zpcum3"       "zpcum4"       "zpcum5"       "zpcum6"       "zpcum7"       "zpcum8"      
# [36] "zpcum9"

###############################################################################################
###   Used versus available habitat and Mmus versus Mbra - exploratory analyses             ###
###############################################################################################

bat.locs <- Bats45 

table(bat.locs$BatID, bat.locs$Species)

#          BRANDTII MYSTACINUS
#Amelia          0         16
#Aricia          0         90
#Astrid         81          0
#Dagny          83          0
#Daisy           0        134
#Ethel           0        117
#Ida             0        119
#Kaja           91          0
#Line            0         55
#Louise          0         64
#Maren         141          0
#Marie           0         31
#Nora           49          0
#Phoebe         62          0
#Ragnhild        0         28
#Reeda           0         70
#Sofia          39          0
#Steffi         39          0
#Stine           0         84
#Thea          101          0
#Turid           0          8


xy.spatial <- SpatialPoints(bat.locs[,c("Easting","Northing")],  
                            proj4string = CRS(
                              "+proj=utm + zone=32 + datum=WGS84 + units=m + no_defs")) 
myobject <- crop(object16, extent(xy.spatial)) 
beep()

#Cropping the lidar data to only the area where we have bat observations
## Convert fom UTM to lat long - reproject 


#Get the lidar variables from 'myobject'
zmax <- myobject$zmax
zmean   <- myobject$zmean  
zsd <- myobject$zsd
zskew    <- myobject$zskew  
zkurt    <- myobject$zkurt    
zentropy   <- myobject$zentropy
pzabovezmean <- myobject$pzabovezmean 
pzabove0.5   <- myobject$pzabove0.5   
zq10 <- myobject$zq10    #Drop z5, z15, z25, z35, z45, z55, z65, z75, z85 (do not need all "levels" - the are very similar)
zq20 <- myobject$zq20     
zq30 <- myobject$zq30   
zq40 <- myobject$zq40   
zq50 <- myobject$zq50   
zq60 <- myobject$zq60   
zq70 <- myobject$zq70   
zq80 <- myobject$zq80   
zq90 <- myobject$zq90   
#Dropped all the cum variables too
beep()
####################################


## Creating a satellite image map of study area 

# require(OpenStreetMap)
# sa<-extent(xy.spatial) # study area 
# proj4string(sa) <- CRS(sa) 


### Had issues mapping this - try some other way ## later## 
# openmap(c(43.46886761482925,119.94873046875),
#     c(33.22949814144951,133.9892578125),
#         minNumTiles=4)
# map <- OpenStreetMap::openmap(c(604765, 6656919), c(607649, 6661050), type='bing') 
# plot(map)
# library(leaflet)
# plot(sa)
# map <- leaflet(sa)
# plot1 <- sa %>% leaflet() %>% 
#    addTiles() 

################################################################################################################
###------------- species and individual-level analyses -------------------------------------------##############
################################################################################################################



###############################################################
###-------------  M. mystacinus bats  ---------------------####
###############################################################

#------Amelia

Amelia.locs <- subset(bat.locs, BatID == "Amelia")

#Determine available space (simplistically: MCP)
Amelia.mcp <- mcp(SpatialPoints(Amelia.locs), 95)
Amelia.mcp.xy <- Amelia.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Amelia.mcp.xy <- fortify(Amelia.mcp)

#Create data frame of covariates

names(Amelia.locs)

Amelia.sp<-SpatialPoints(Amelia.locs)


used.Amelia.df <- data.frame(
  used = rep(1, length(Amelia.sp)),
  Species = rep("Mys", length(Amelia.sp)),
  BatID = rep("Amelia", length(Amelia.sp)),
  zmax = extract(zmax, Amelia.sp),
  zmean = extract(zmean, Amelia.sp),
  zsd = extract(zsd, Amelia.sp),
  zentropy = extract(zentropy, Amelia.sp),
  pzabovezmean = extract(pzabovezmean, Amelia.sp),
  pzabove0.5 = extract(pzabove0.5, Amelia.sp),
  zq10 = extract(zq10, Amelia.sp),
  zq20 = extract(zq20, Amelia.sp),
  zq30 = extract(zq30, Amelia.sp),
  zq40 = extract(zq40, Amelia.sp),
  zq50 = extract(zq50, Amelia.sp),
  zq60 = extract(zq60, Amelia.sp),
  zq70 = extract(zq70, Amelia.sp),
  zq80 = extract(zq80, Amelia.sp),
  zq90 = extract(zq90, Amelia.sp))

head(used.Amelia.df)
summary(used.Amelia.df)
dim(used.Amelia.df)



#######################################
#Obtain some random points within mcp

random.points.Amelia <- spsample(Amelia.mcp, 16, "random")

#Calculate the covariates for the null set

avail.Amelia.df <- data.frame(
  used = rep(0, length(random.points.Amelia)),
  Species = rep("Mys", length(Amelia.sp)),
  BatID = rep("Amelia", length(Amelia.sp)),
  zmax = extract(zmax, random.points.Amelia),
  zmean = extract(zmean, random.points.Amelia),
  zsd = extract(zsd, random.points.Amelia),
  zentropy = extract(zentropy, random.points.Amelia),
  pzabovezmean = extract(pzabovezmean, random.points.Amelia),
  pzabove0.5 = extract(pzabove0.5, random.points.Amelia),
  zq10 = extract(zq10, random.points.Amelia),
  zq20 = extract(zq20, random.points.Amelia),
  zq30 = extract(zq30, random.points.Amelia),
  zq40 = extract(zq40, random.points.Amelia),
  zq50 = extract(zq50, random.points.Amelia),
  zq60 = extract(zq60, random.points.Amelia),
  zq70 = extract(zq70, random.points.Amelia),
  zq80 = extract(zq80, random.points.Amelia),
  zq90 = extract(zq90, random.points.Amelia))

head(avail.Amelia.df)
summary(avail.Amelia.df)
dim(avail.Amelia.df)



#------Aricia

Aricia.locs <- subset(bat.locs, BatID == "Aricia")

#Determine available space (simplistically: MCP)
Aricia.mcp <- mcp(SpatialPoints(Aricia.locs), 95)
Aricia.mcp.xy <- Aricia.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Aricia.mcp.xy <- fortify(Aricia.mcp)


#Create data frame of covariates

names(Aricia.locs)

Aricia.sp<-SpatialPoints(Aricia.locs)


used.Aricia.df <- data.frame(
  used = rep(1, length(Aricia.sp)),
  Species = rep("Mys", length(Aricia.sp)),
  BatID = rep("Aricia", length(Aricia.sp)),
  zmax = extract(zmax, Aricia.sp),
  zmean = extract(zmean, Aricia.sp),
  zsd = extract(zsd, Aricia.sp),
  zentropy = extract(zentropy, Aricia.sp),
  pzabovezmean = extract(pzabovezmean, Aricia.sp),
  pzabove0.5 = extract(pzabove0.5, Aricia.sp),
  zq10 = extract(zq10, Aricia.sp),
  zq20 = extract(zq20, Aricia.sp),
  zq30 = extract(zq30, Aricia.sp),
  zq40 = extract(zq40, Aricia.sp),
  zq50 = extract(zq50, Aricia.sp),
  zq60 = extract(zq60, Aricia.sp),
  zq70 = extract(zq70, Aricia.sp),
  zq80 = extract(zq80, Aricia.sp),
  zq90 = extract(zq90, Aricia.sp))

head(used.Aricia.df)
summary(used.Aricia.df)
dim(used.Aricia.df)



#######################################
#Obtain some random points within mcp

random.points.Aricia <- spsample(Aricia.mcp, 90, "random")

#Calculate the covariates for the null set

avail.Aricia.df <- data.frame(
  used = rep(0, length(random.points.Aricia)),
  Species = rep("Mys", length(Aricia.sp)),
  BatID = rep("Aricia", length(Aricia.sp)),
  zmax = extract(zmax, random.points.Aricia),
  zmean = extract(zmean, random.points.Aricia),
  zsd = extract(zsd, random.points.Aricia),
  zentropy = extract(zentropy, random.points.Aricia),
  pzabovezmean = extract(pzabovezmean, random.points.Aricia),
  pzabove0.5 = extract(pzabove0.5, random.points.Aricia),
  zq10 = extract(zq10, random.points.Aricia),
  zq20 = extract(zq20, random.points.Aricia),
  zq30 = extract(zq30, random.points.Aricia),
  zq40 = extract(zq40, random.points.Aricia),
  zq50 = extract(zq50, random.points.Aricia),
  zq60 = extract(zq60, random.points.Aricia),
  zq70 = extract(zq70, random.points.Aricia),
  zq80 = extract(zq80, random.points.Aricia),
  zq90 = extract(zq90, random.points.Aricia))


head(avail.Aricia.df)
summary(avail.Aricia.df)
dim(avail.Aricia.df)



#------Daisy

Daisy.locs <- subset(bat.locs, BatID == "Daisy")

#Determine available space (simplistically: MCP)
Daisy.mcp <- mcp(SpatialPoints(Daisy.locs), 95)
Daisy.mcp.xy <- Daisy.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Daisy.mcp.xy <- fortify(Daisy.mcp)


#Create data frame of covariates

names(Daisy.locs)

Daisy.sp<-SpatialPoints(Daisy.locs)


used.Daisy.df <- data.frame(
  used = rep(1, length(Daisy.sp)),
  Species = rep("Mys", length(Daisy.sp)),
  BatID = rep("Daisy", length(Daisy.sp)),
  zmax = extract(zmax, Daisy.sp),
  zmean = extract(zmean, Daisy.sp),
  zsd = extract(zsd, Daisy.sp),
  zentropy = extract(zentropy, Daisy.sp),
  pzabovezmean = extract(pzabovezmean, Daisy.sp),
  pzabove0.5 = extract(pzabove0.5, Daisy.sp),
  zq10 = extract(zq10, Daisy.sp),
  zq20 = extract(zq20, Daisy.sp),
  zq30 = extract(zq30, Daisy.sp),
  zq40 = extract(zq40, Daisy.sp),
  zq50 = extract(zq50, Daisy.sp),
  zq60 = extract(zq60, Daisy.sp),
  zq70 = extract(zq70, Daisy.sp),
  zq80 = extract(zq80, Daisy.sp),
  zq90 = extract(zq90, Daisy.sp))


head(used.Daisy.df)
summary(used.Daisy.df)
dim(used.Daisy.df)



#######################################
#Obtain some random points within mcp

random.points.Daisy <- spsample(Daisy.mcp, 134, "random")

#Calculate the covariates for the null set

avail.Daisy.df <- data.frame(
  used = rep(0, length(random.points.Daisy)),
  Species = rep("Mys", length(Daisy.sp)),
  BatID = rep("Daisy", length(Daisy.sp)),
  zmax = extract(zmax, random.points.Daisy),
  zmean = extract(zmean, random.points.Daisy),
  zsd = extract(zsd, random.points.Daisy),
  zentropy = extract(zentropy, random.points.Daisy),
  pzabovezmean = extract(pzabovezmean, random.points.Daisy),
  pzabove0.5 = extract(pzabove0.5, random.points.Daisy),
  zq10 = extract(zq10, random.points.Daisy),
  zq20 = extract(zq20, random.points.Daisy),
  zq30 = extract(zq30, random.points.Daisy),
  zq40 = extract(zq40, random.points.Daisy),
  zq50 = extract(zq50, random.points.Daisy),
  zq60 = extract(zq60, random.points.Daisy),
  zq70 = extract(zq70, random.points.Daisy),
  zq80 = extract(zq80, random.points.Daisy),
  zq90 = extract(zq90, random.points.Daisy))


head(avail.Daisy.df)
summary(avail.Daisy.df)
dim(avail.Daisy.df)


#------Ethel

Ethel.locs <- subset(bat.locs, BatID == "Ethel")

#Determine available space (simplistically: MCP)
Ethel.mcp <- mcp(SpatialPoints(Ethel.locs), 95)
Ethel.mcp.xy <- Ethel.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Ethel.mcp.xy <- fortify(Ethel.mcp)



#Create data frame of covariates

names(Ethel.locs)

Ethel.sp<-SpatialPoints(Ethel.locs)


used.Ethel.df <- data.frame(
  used = rep(1, length(Ethel.sp)),
  Species = rep("Mys", length(Ethel.sp)),
  BatID = rep("Ethel", length(Ethel.sp)),
  zmax = extract(zmax, Ethel.sp),
  zmean = extract(zmean, Ethel.sp),
  zsd = extract(zsd, Ethel.sp),
  zentropy = extract(zentropy, Ethel.sp),
  pzabovezmean = extract(pzabovezmean, Ethel.sp),
  pzabove0.5 = extract(pzabove0.5, Ethel.sp),
  zq10 = extract(zq10, Ethel.sp),
  zq20 = extract(zq20, Ethel.sp),
  zq30 = extract(zq30, Ethel.sp),
  zq40 = extract(zq40, Ethel.sp),
  zq50 = extract(zq50, Ethel.sp),
  zq60 = extract(zq60, Ethel.sp),
  zq70 = extract(zq70, Ethel.sp),
  zq80 = extract(zq80, Ethel.sp),
  zq90 = extract(zq90, Ethel.sp))

head(used.Ethel.df)
summary(used.Ethel.df)
dim(used.Ethel.df)



#######################################
#Obtain some random points within mcp

random.points.Ethel <- spsample(Ethel.mcp, 117, "random")

#Calculate the covariates for the null set

avail.Ethel.df <- data.frame(
  used = rep(0, length(random.points.Ethel)),
  Species = rep("Mys", length(Ethel.sp)),
  BatID = rep("Ethel", length(Ethel.sp)),
  zmax = extract(zmax, random.points.Ethel),
  zmean = extract(zmean, random.points.Ethel),
  zsd = extract(zsd, random.points.Ethel),
  zentropy = extract(zentropy, random.points.Ethel),
  pzabovezmean = extract(pzabovezmean, random.points.Ethel),
  pzabove0.5 = extract(pzabove0.5, random.points.Ethel),
  zq10 = extract(zq10, random.points.Ethel),
  zq20 = extract(zq20, random.points.Ethel),
  zq30 = extract(zq30, random.points.Ethel),
  zq40 = extract(zq40, random.points.Ethel),
  zq50 = extract(zq50, random.points.Ethel),
  zq60 = extract(zq60, random.points.Ethel),
  zq70 = extract(zq70, random.points.Ethel),
  zq80 = extract(zq80, random.points.Ethel),
  zq90 = extract(zq90, random.points.Ethel))


head(avail.Ethel.df)
summary(avail.Ethel.df)
dim(avail.Ethel.df)




#------Ida

Ida.locs <- subset(bat.locs, BatID == "Ida")

#Determine available space (simplistically: MCP)
Ida.mcp <- mcp(SpatialPoints(Ida.locs), 95)
Ida.mcp.xy <- Ida.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Ida.mcp.xy <- fortify(Ida.mcp)



#Create data frame of covariates

names(Ida.locs)

Ida.sp<-SpatialPoints(Ida.locs)


used.Ida.df <- data.frame(
  used = rep(1, length(Ida.sp)),
  Species = rep("Mys", length(Ida.sp)),
  BatID = rep("Ida", length(Ida.sp)),
  zmax = extract(zmax, Ida.sp),
  zmean = extract(zmean, Ida.sp),
  zsd = extract(zsd, Ida.sp),
  zentropy = extract(zentropy, Ida.sp),
  pzabovezmean = extract(pzabovezmean, Ida.sp),
  pzabove0.5 = extract(pzabove0.5, Ida.sp),
  zq10 = extract(zq10, Ida.sp),
  zq20 = extract(zq20, Ida.sp),
  zq30 = extract(zq30, Ida.sp),
  zq40 = extract(zq40, Ida.sp),
  zq50 = extract(zq50, Ida.sp),
  zq60 = extract(zq60, Ida.sp),
  zq70 = extract(zq70, Ida.sp),
  zq80 = extract(zq80, Ida.sp),
  zq90 = extract(zq90, Ida.sp))


head(used.Ida.df)
summary(used.Ida.df)
dim(used.Ida.df)



#######################################
#Obtain some random points within mcp

random.points.Ida <- spsample(Ida.mcp, 119, "random")

#Calculate the covariates for the null set

avail.Ida.df <- data.frame(
  used = rep(0, length(random.points.Ida)),
  Species = rep("Mys", length(Ida.sp)),
  BatID = rep("Ida", length(Ida.sp)),
  zmax = extract(zmax, random.points.Ida),
  zmean = extract(zmean, random.points.Ida),
  zsd = extract(zsd, random.points.Ida),
  zentropy = extract(zentropy, random.points.Ida),
  pzabovezmean = extract(pzabovezmean, random.points.Ida),
  pzabove0.5 = extract(pzabove0.5, random.points.Ida),
  zq10 = extract(zq10, random.points.Ida),
  zq20 = extract(zq20, random.points.Ida),
  zq30 = extract(zq30, random.points.Ida),
  zq40 = extract(zq40, random.points.Ida),
  zq50 = extract(zq50, random.points.Ida),
  zq60 = extract(zq60, random.points.Ida),
  zq70 = extract(zq70, random.points.Ida),
  zq80 = extract(zq80, random.points.Ida),
  zq90 = extract(zq90, random.points.Ida))


head(avail.Ida.df)
summary(avail.Ida.df)
dim(avail.Ida.df)



#------Line

Line.locs <- subset(bat.locs, BatID == "Line")

#Determine available space (simplistically: MCP)
Line.mcp <- mcp(SpatialPoints(Line.locs), 95)
Line.mcp.xy <- Line.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Line.mcp.xy <- fortify(Line.mcp)



#Create data frame of covariates

names(Line.locs)

Line.sp<-SpatialPoints(Line.locs)


used.Line.df <- data.frame(
  used = rep(1, length(Line.sp)),
  Species = rep("Mys", length(Line.sp)),
  BatID = rep("Line", length(Line.sp)),
  zmax = extract(zmax, Line.sp),
  zmean = extract(zmean, Line.sp),
  zsd = extract(zsd, Line.sp),
  zentropy = extract(zentropy, Line.sp),
  pzabovezmean = extract(pzabovezmean, Line.sp),
  pzabove0.5 = extract(pzabove0.5, Line.sp),
  zq10 = extract(zq10, Line.sp),
  zq20 = extract(zq20, Line.sp),
  zq30 = extract(zq30, Line.sp),
  zq40 = extract(zq40, Line.sp),
  zq50 = extract(zq50, Line.sp),
  zq60 = extract(zq60, Line.sp),
  zq70 = extract(zq70, Line.sp),
  zq80 = extract(zq80, Line.sp),
  zq90 = extract(zq90, Line.sp))


head(used.Line.df)
summary(used.Line.df)
dim(used.Line.df)



#######################################
#Obtain some random points within mcp

random.points.Line <- spsample(Line.mcp, 55, "random")

#Calculate the covariates for the null set

avail.Line.df <- data.frame(
  used = rep(0, length(random.points.Line)),
  Species = rep("Mys", length(Line.sp)),
  BatID = rep("Line", length(Line.sp)),
  zmax = extract(zmax, random.points.Line),
  zmean = extract(zmean, random.points.Line),
  zsd = extract(zsd, random.points.Line),
  zentropy = extract(zentropy, random.points.Line),
  pzabovezmean = extract(pzabovezmean, random.points.Line),
  pzabove0.5 = extract(pzabove0.5, random.points.Line),
  zq10 = extract(zq10, random.points.Line),
  zq20 = extract(zq20, random.points.Line),
  zq30 = extract(zq30, random.points.Line),
  zq40 = extract(zq40, random.points.Line),
  zq50 = extract(zq50, random.points.Line),
  zq60 = extract(zq60, random.points.Line),
  zq70 = extract(zq70, random.points.Line),
  zq80 = extract(zq80, random.points.Line),
  zq90 = extract(zq90, random.points.Line))

head(avail.Line.df)
summary(avail.Line.df)
dim(avail.Line.df)




#------Louise

Louise.locs <- subset(bat.locs, BatID == "Louise")

#Determine available space (simplistically: MCP)
Louise.mcp <- mcp(SpatialPoints(Louise.locs), 95)
Louise.mcp.xy <- Louise.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Louise.mcp.xy <- fortify(Louise.mcp)


#Create data frame of covariates

names(Louise.locs)

Louise.sp<-SpatialPoints(Louise.locs)


used.Louise.df <- data.frame(
  used = rep(1, length(Louise.sp)),
  Species = rep("Mys", length(Louise.sp)),
  BatID = rep("Louise", length(Louise.sp)),
  zmax = extract(zmax, Louise.sp),
  zmean = extract(zmean, Louise.sp),
  zsd = extract(zsd, Louise.sp),
  zentropy = extract(zentropy, Louise.sp),
  pzabovezmean = extract(pzabovezmean, Louise.sp),
  pzabove0.5 = extract(pzabove0.5, Louise.sp),
  zq10 = extract(zq10, Louise.sp),
  zq20 = extract(zq20, Louise.sp),
  zq30 = extract(zq30, Louise.sp),
  zq40 = extract(zq40, Louise.sp),
  zq50 = extract(zq50, Louise.sp),
  zq60 = extract(zq60, Louise.sp),
  zq70 = extract(zq70, Louise.sp),
  zq80 = extract(zq80, Louise.sp),
  zq90 = extract(zq90, Louise.sp))


head(used.Louise.df)
summary(used.Louise.df)
dim(used.Louise.df)



#######################################
#Obtain some random points within mcp

random.points.Louise <- spsample(Louise.mcp, 64, "random")

#Calculate the covariates for the null set

avail.Louise.df <- data.frame(
  used = rep(0, length(random.points.Louise)),
  Species = rep("Mys", length(Louise.sp)),
  BatID = rep("Louise", length(Louise.sp)),
  zmax = extract(zmax, random.points.Louise),
  zmean = extract(zmean, random.points.Louise),
  zsd = extract(zsd, random.points.Louise),
  zentropy = extract(zentropy, random.points.Louise),
  pzabovezmean = extract(pzabovezmean, random.points.Louise),
  pzabove0.5 = extract(pzabove0.5, random.points.Louise),
  zq10 = extract(zq10, random.points.Louise),
  zq20 = extract(zq20, random.points.Louise),
  zq30 = extract(zq30, random.points.Louise),
  zq40 = extract(zq40, random.points.Louise),
  zq50 = extract(zq50, random.points.Louise),
  zq60 = extract(zq60, random.points.Louise),
  zq70 = extract(zq70, random.points.Louise),
  zq80 = extract(zq80, random.points.Louise),
  zq90 = extract(zq90, random.points.Louise))


head(avail.Louise.df)
summary(avail.Louise.df)
dim(avail.Louise.df)



#------Marie

Marie.locs <- subset(bat.locs, BatID == "Marie")

#Determine available space (simplistically: MCP)
Marie.mcp <- mcp(SpatialPoints(Marie.locs), 95)
Marie.mcp.xy <- Marie.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Marie.mcp.xy <- fortify(Marie.mcp)



#Create data frame of covariates

names(Marie.locs)

Marie.sp<-SpatialPoints(Marie.locs)


used.Marie.df <- data.frame(
  used = rep(1, length(Marie.sp)),
  Species = rep("Mys", length(Marie.sp)),
  BatID = rep("Marie", length(Marie.sp)),
  zmax = extract(zmax, Marie.sp),
  zmean = extract(zmean, Marie.sp),
  zsd = extract(zsd, Marie.sp),
  zentropy = extract(zentropy, Marie.sp),
  pzabovezmean = extract(pzabovezmean, Marie.sp),
  pzabove0.5 = extract(pzabove0.5, Marie.sp),
  zq10 = extract(zq10, Marie.sp),
  zq20 = extract(zq20, Marie.sp),
  zq30 = extract(zq30, Marie.sp),
  zq40 = extract(zq40, Marie.sp),
  zq50 = extract(zq50, Marie.sp),
  zq60 = extract(zq60, Marie.sp),
  zq70 = extract(zq70, Marie.sp),
  zq80 = extract(zq80, Marie.sp),
  zq90 = extract(zq90, Marie.sp))


head(used.Marie.df)
summary(used.Marie.df)
dim(used.Marie.df)



#######################################
#Obtain some random points within mcp

random.points.Marie <- spsample(Marie.mcp, 31, "random")

#Calculate the covariates for the null set

avail.Marie.df <- data.frame(
  used = rep(0, length(random.points.Marie)),
  Species = rep("Mys", length(Marie.sp)),
  BatID = rep("Marie", length(Marie.sp)),
  zmax = extract(zmax, random.points.Marie),
  zmean = extract(zmean, random.points.Marie),
  zsd = extract(zsd, random.points.Marie),
  zentropy = extract(zentropy, random.points.Marie),
  pzabovezmean = extract(pzabovezmean, random.points.Marie),
  pzabove0.5 = extract(pzabove0.5, random.points.Marie),
  zq10 = extract(zq10, random.points.Marie),
  zq20 = extract(zq20, random.points.Marie),
  zq30 = extract(zq30, random.points.Marie),
  zq40 = extract(zq40, random.points.Marie),
  zq50 = extract(zq50, random.points.Marie),
  zq60 = extract(zq60, random.points.Marie),
  zq70 = extract(zq70, random.points.Marie),
  zq80 = extract(zq80, random.points.Marie),
  zq90 = extract(zq90, random.points.Marie))


head(avail.Marie.df)
summary(avail.Marie.df)
dim(avail.Marie.df) 



#------Ragnhild

Ragnhild.locs <- subset(bat.locs, BatID == "Ragnhild")

#Determine available space (simplistically: MCP)
Ragnhild.mcp <- mcp(SpatialPoints(Ragnhild.locs), 95)
Ragnhild.mcp.xy <- Ragnhild.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Ragnhild.mcp.xy <- fortify(Ragnhild.mcp)



#Create data frame of covariates

names(Ragnhild.locs)

Ragnhild.sp<-SpatialPoints(Ragnhild.locs)


used.Ragnhild.df <- data.frame(
  used = rep(1, length(Ragnhild.sp)),
  Species = rep("Mys", length(Ragnhild.sp)),
  BatID = rep("Ragnhild", length(Ragnhild.sp)),
  zmax = extract(zmax, Ragnhild.sp),
  zmean = extract(zmean, Ragnhild.sp),
  zsd = extract(zsd, Ragnhild.sp),
  zentropy = extract(zentropy, Ragnhild.sp),
  pzabovezmean = extract(pzabovezmean, Ragnhild.sp),
  pzabove0.5 = extract(pzabove0.5, Ragnhild.sp),
  zq10 = extract(zq10, Ragnhild.sp),
  zq20 = extract(zq20, Ragnhild.sp),
  zq30 = extract(zq30, Ragnhild.sp),
  zq40 = extract(zq40, Ragnhild.sp),
  zq50 = extract(zq50, Ragnhild.sp),
  zq60 = extract(zq60, Ragnhild.sp),
  zq70 = extract(zq70, Ragnhild.sp),
  zq80 = extract(zq80, Ragnhild.sp),
  zq90 = extract(zq90, Ragnhild.sp))


head(used.Ragnhild.df)
summary(used.Ragnhild.df)
dim(used.Ragnhild.df)



#######################################
#Obtain some random points within mcp

random.points.Ragnhild <- spsample(Ragnhild.mcp, 28, "random")

#Calculate the covariates for the null set

avail.Ragnhild.df <- data.frame(
  used = rep(0, length(random.points.Ragnhild)),
  Species = rep("Mys", length(Ragnhild.sp)),
  BatID = rep("Ragnhild", length(Ragnhild.sp)),
  zmax = extract(zmax, random.points.Ragnhild),
  zmean = extract(zmean, random.points.Ragnhild),
  zsd = extract(zsd, random.points.Ragnhild),
  zentropy = extract(zentropy, random.points.Ragnhild),
  pzabovezmean = extract(pzabovezmean, random.points.Ragnhild),
  pzabove0.5 = extract(pzabove0.5, random.points.Ragnhild),
  zq10 = extract(zq10, random.points.Ragnhild),
  zq20 = extract(zq20, random.points.Ragnhild),
  zq30 = extract(zq30, random.points.Ragnhild),
  zq40 = extract(zq40, random.points.Ragnhild),
  zq50 = extract(zq50, random.points.Ragnhild),
  zq60 = extract(zq60, random.points.Ragnhild),
  zq70 = extract(zq70, random.points.Ragnhild),
  zq80 = extract(zq80, random.points.Ragnhild),
  zq90 = extract(zq90, random.points.Ragnhild))


head(avail.Ragnhild.df)
summary(avail.Ragnhild.df)
dim(avail.Ragnhild.df)



#------Reeda

Reeda.locs <- subset(bat.locs, BatID == "Reeda")

#Determine available space (simplistically: MCP)
Reeda.mcp <- mcp(SpatialPoints(Reeda.locs), 95)
Reeda.mcp.xy <- Reeda.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Reeda.mcp.xy <- fortify(Reeda.mcp)



#Create data frame of covariates

names(Reeda.locs)

Reeda.sp<-SpatialPoints(Reeda.locs)


used.Reeda.df <- data.frame(
  used = rep(1, length(Reeda.sp)),
  Species = rep("Mys", length(Reeda.sp)),
  BatID = rep("Reeda", length(Reeda.sp)),
  zmax = extract(zmax, Reeda.sp),
  zmean = extract(zmean, Reeda.sp),
  zsd = extract(zsd, Reeda.sp),
  zentropy = extract(zentropy, Reeda.sp),
  pzabovezmean = extract(pzabovezmean, Reeda.sp),
  pzabove0.5 = extract(pzabove0.5, Reeda.sp),
  zq10 = extract(zq10, Reeda.sp),
  zq20 = extract(zq20, Reeda.sp),
  zq30 = extract(zq30, Reeda.sp),
  zq40 = extract(zq40, Reeda.sp),
  zq50 = extract(zq50, Reeda.sp),
  zq60 = extract(zq60, Reeda.sp),
  zq70 = extract(zq70, Reeda.sp),
  zq80 = extract(zq80, Reeda.sp),
  zq90 = extract(zq90, Reeda.sp))


head(used.Reeda.df)
summary(used.Reeda.df)
dim(used.Reeda.df)



#######################################
#Obtain some random points within mcp

random.points.Reeda <- spsample(Reeda.mcp, 70, "random")

#Calculate the covariates for the null set

avail.Reeda.df <- data.frame(
  used = rep(0, length(random.points.Reeda)),
  Species = rep("Mys", length(Reeda.sp)),
  BatID = rep("Reeda", length(Reeda.sp)),
  zmax = extract(zmax, random.points.Reeda),
  zmean = extract(zmean, random.points.Reeda),
  zsd = extract(zsd, random.points.Reeda),
  zentropy = extract(zentropy, random.points.Reeda),
  pzabovezmean = extract(pzabovezmean, random.points.Reeda),
  pzabove0.5 = extract(pzabove0.5, random.points.Reeda),
  zq10 = extract(zq10, random.points.Reeda),
  zq20 = extract(zq20, random.points.Reeda),
  zq30 = extract(zq30, random.points.Reeda),
  zq40 = extract(zq40, random.points.Reeda),
  zq50 = extract(zq50, random.points.Reeda),
  zq60 = extract(zq60, random.points.Reeda),
  zq70 = extract(zq70, random.points.Reeda),
  zq80 = extract(zq80, random.points.Reeda),
  zq90 = extract(zq90, random.points.Reeda))


head(avail.Reeda.df)
summary(avail.Reeda.df)
dim(avail.Reeda.df)




#------Stine

Stine.locs <- subset(bat.locs, BatID == "Stine")

#Determine available space (simplistically: MCP)
Stine.mcp <- mcp(SpatialPoints(Stine.locs), 95)
Stine.mcp.xy <- Stine.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Stine.mcp.xy <- fortify(Stine.mcp)



#Create data frame of covariates

names(Stine.locs)

Stine.sp<-SpatialPoints(Stine.locs)


used.Stine.df <- data.frame(
  used = rep(1, length(Stine.sp)),
  Species = rep("Mys", length(Stine.sp)),
  BatID = rep("Stine", length(Stine.sp)),
  zmax = extract(zmax, Stine.sp),
  zmean = extract(zmean, Stine.sp),
  zsd = extract(zsd, Stine.sp),
  zentropy = extract(zentropy, Stine.sp),
  pzabovezmean = extract(pzabovezmean, Stine.sp),
  pzabove0.5 = extract(pzabove0.5, Stine.sp),
  zq10 = extract(zq10, Stine.sp),
  zq20 = extract(zq20, Stine.sp),
  zq30 = extract(zq30, Stine.sp),
  zq40 = extract(zq40, Stine.sp),
  zq50 = extract(zq50, Stine.sp),
  zq60 = extract(zq60, Stine.sp),
  zq70 = extract(zq70, Stine.sp),
  zq80 = extract(zq80, Stine.sp),
  zq90 = extract(zq90, Stine.sp))


head(used.Stine.df)
summary(used.Stine.df)
dim(used.Stine.df)



#######################################
#Obtain some random points within mcp

random.points.Stine <- spsample(Stine.mcp, 84, "random")

#Calculate the covariates for the null set

avail.Stine.df <- data.frame(
  used = rep(0, length(random.points.Stine)),
  Species = rep("Mys", length(Stine.sp)),
  BatID = rep("Stine", length(Stine.sp)),
  zmax = extract(zmax, random.points.Stine),
  zmean = extract(zmean, random.points.Stine),
  zsd = extract(zsd, random.points.Stine),
  zentropy = extract(zentropy, random.points.Stine),
  pzabovezmean = extract(pzabovezmean, random.points.Stine),
  pzabove0.5 = extract(pzabove0.5, random.points.Stine),
  zq10 = extract(zq10, random.points.Stine),
  zq20 = extract(zq20, random.points.Stine),
  zq30 = extract(zq30, random.points.Stine),
  zq40 = extract(zq40, random.points.Stine),
  zq50 = extract(zq50, random.points.Stine),
  zq60 = extract(zq60, random.points.Stine),
  zq70 = extract(zq70, random.points.Stine),
  zq80 = extract(zq80, random.points.Stine),
  zq90 = extract(zq90, random.points.Stine))


head(avail.Stine.df)
summary(avail.Stine.df)
dim(avail.Stine.df)



#------Turid

Turid.locs <- subset(bat.locs, BatID == "Turid")

#Determine available space (simplistically: MCP)
Turid.mcp <- mcp(SpatialPoints(Turid.locs), 95)
Turid.mcp.xy <- Turid.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Turid.mcp.xy <- fortify(Turid.mcp)



#Create data frame of covariates

names(Turid.locs)

Turid.sp<-SpatialPoints(Turid.locs)


used.Turid.df <- data.frame(
  used = rep(1, length(Turid.sp)),
  Species = rep("Mys", length(Turid.sp)),
  BatID = rep("Turid", length(Turid.sp)),
  zmax = extract(zmax, Turid.sp),
  zmean = extract(zmean, Turid.sp),
  zsd = extract(zsd, Turid.sp),
  zentropy = extract(zentropy, Turid.sp),
  pzabovezmean = extract(pzabovezmean, Turid.sp),
  pzabove0.5 = extract(pzabove0.5, Turid.sp),
  zq10 = extract(zq10, Turid.sp),
  zq20 = extract(zq20, Turid.sp),
  zq30 = extract(zq30, Turid.sp),
  zq40 = extract(zq40, Turid.sp),
  zq50 = extract(zq50, Turid.sp),
  zq60 = extract(zq60, Turid.sp),
  zq70 = extract(zq70, Turid.sp),
  zq80 = extract(zq80, Turid.sp),
  zq90 = extract(zq90, Turid.sp))


head(used.Turid.df)
summary(used.Turid.df)
dim(used.Turid.df)




#######################################
#Obtain some random points within mcp

random.points.Turid <- spsample(Turid.mcp, 8, "random")

#Calculate the covariates for the null set

avail.Turid.df <- data.frame(
  used = rep(0, length(random.points.Turid)),
  Species = rep("Mys", length(Turid.sp)),
  BatID = rep("Turid", length(Turid.sp)),
  zmax = extract(zmax, random.points.Turid),
  zmean = extract(zmean, random.points.Turid),
  zsd = extract(zsd, random.points.Turid),
  zentropy = extract(zentropy, random.points.Turid),
  pzabovezmean = extract(pzabovezmean, random.points.Turid),
  pzabove0.5 = extract(pzabove0.5, random.points.Turid),
  zq10 = extract(zq10, random.points.Turid),
  zq20 = extract(zq20, random.points.Turid),
  zq30 = extract(zq30, random.points.Turid),
  zq40 = extract(zq40, random.points.Turid),
  zq50 = extract(zq50, random.points.Turid),
  zq60 = extract(zq60, random.points.Turid),
  zq70 = extract(zq70, random.points.Turid),
  zq80 = extract(zq80, random.points.Turid),
  zq90 = extract(zq90, random.points.Turid))


head(avail.Turid.df)
summary(avail.Turid.df)
dim(avail.Turid.df)


#Combine Used data for all Mmys individuals
Mmys.data.used <- rbind(
  used.Amelia.df, 
  used.Aricia.df, 
  used.Daisy.df, 
  used.Ethel.df,
  used.Ida.df, 
  used.Line.df, 
  used.Louise.df, 
  used.Marie.df, 
  used.Ragnhild.df, 
  used.Reeda.df, 
  used.Stine.df, 
  used.Turid.df)
head(Mmys.data.used)
summary(Mmys.data.used)
dim(Mmys.data.used)
table(Mmys.data.used$BatID)

#Combine Avilable data for all Mmys individuals
Mmys.data.avail <- rbind(
  avail.Amelia.df, 
  avail.Aricia.df, 
  avail.Daisy.df, 
  avail.Ethel.df,
  avail.Ida.df, 
  avail.Line.df, 
  avail.Louise.df, 
  avail.Marie.df, 
  avail.Ragnhild.df, 
  avail.Reeda.df, 
  avail.Stine.df, 
  avail.Turid.df)
head(Mmys.data.avail)
summary(Mmys.data.avail)
dim(Mmys.data.avail)
table(Mmys.data.avail$BatID)

#Combine Used and Avilable data for all Mmys individuals
Mmys.data <- rbind(Mmys.data.used, Mmys.data.avail)
head(Mmys.data)
summary(Mmys.data)
dim(Mmys.data)
table(Mmys.data$BatID)

###############################################################
###-------------  M. brandtii bats  ------------------------####
###############################################################

#------Astrid

Astrid.locs <- subset(bat.locs, BatID == "Astrid")

#Determine available space (simplistically: MCP)
Astrid.mcp <- mcp(SpatialPoints(Astrid.locs), 95)
Astrid.mcp.xy <- Astrid.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Astrid.mcp.xy <- fortify(Astrid.mcp)



#Create data frame of covariates

names(Astrid.locs)

Astrid.sp<-SpatialPoints(Astrid.locs)


used.Astrid.df <- data.frame(
  used = rep(1, length(Astrid.sp)),
  Species = rep("Mbra", length(Astrid.sp)),
  BatID = rep("Astrid", length(Astrid.sp)),
  zmax = extract(zmax, Astrid.sp),
  zmean = extract(zmean, Astrid.sp),
  zsd = extract(zsd, Astrid.sp),
  zentropy = extract(zentropy, Astrid.sp),
  pzabovezmean = extract(pzabovezmean, Astrid.sp),
  pzabove0.5 = extract(pzabove0.5, Astrid.sp),
  zq10 = extract(zq10, Astrid.sp),
  zq20 = extract(zq20, Astrid.sp),
  zq30 = extract(zq30, Astrid.sp),
  zq40 = extract(zq40, Astrid.sp),
  zq50 = extract(zq50, Astrid.sp),
  zq60 = extract(zq60, Astrid.sp),
  zq70 = extract(zq70, Astrid.sp),
  zq80 = extract(zq80, Astrid.sp),
  zq90 = extract(zq90, Astrid.sp))


head(used.Astrid.df)
summary(used.Astrid.df)
dim(used.Astrid.df) 



#######################################
#Obtain some random points within mcp

random.points.Astrid <- spsample(Astrid.mcp, 81, "random")

#Calculate the covariates for the null set

avail.Astrid.df <- data.frame(
  used = rep(0, length(random.points.Astrid)),
  Species = rep("Mbra", length(Astrid.sp)),
  BatID = rep("Astrid", length(Astrid.sp)),
  zmax = extract(zmax, random.points.Astrid),
  zmean = extract(zmean, random.points.Astrid),
  zsd = extract(zsd, random.points.Astrid),
  zentropy = extract(zentropy, random.points.Astrid),
  pzabovezmean = extract(pzabovezmean, random.points.Astrid),
  pzabove0.5 = extract(pzabove0.5, random.points.Astrid),
  zq10 = extract(zq10, random.points.Astrid),
  zq20 = extract(zq20, random.points.Astrid),
  zq30 = extract(zq30, random.points.Astrid),
  zq40 = extract(zq40, random.points.Astrid),
  zq50 = extract(zq50, random.points.Astrid),
  zq60 = extract(zq60, random.points.Astrid),
  zq70 = extract(zq70, random.points.Astrid),
  zq80 = extract(zq80, random.points.Astrid),
  zq90 = extract(zq90, random.points.Astrid))


head(avail.Astrid.df)
summary(avail.Astrid.df)
dim(avail.Astrid.df)


#------Dagny

Dagny.locs <- subset(bat.locs, BatID == "Dagny")

#Determine available space (simplistically: MCP)
Dagny.mcp <- mcp(SpatialPoints(Dagny.locs), 95)
Dagny.mcp.xy <- Dagny.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Dagny.mcp.xy <- fortify(Dagny.mcp)


#Create data frame of covariates

names(Dagny.locs)

Dagny.sp<-SpatialPoints(Dagny.locs)


used.Dagny.df <- data.frame(
  used = rep(1, length(Dagny.sp)),
  Species = rep("Mbra", length(Dagny.sp)),
  BatID = rep("Dagny", length(Dagny.sp)),
  zmax = extract(zmax, Dagny.sp),
  zmean = extract(zmean, Dagny.sp),
  zsd = extract(zsd, Dagny.sp),
  zentropy = extract(zentropy, Dagny.sp),
  pzabovezmean = extract(pzabovezmean, Dagny.sp),
  pzabove0.5 = extract(pzabove0.5, Dagny.sp),
  zq10 = extract(zq10, Dagny.sp),
  zq20 = extract(zq20, Dagny.sp),
  zq30 = extract(zq30, Dagny.sp),
  zq40 = extract(zq40, Dagny.sp),
  zq50 = extract(zq50, Dagny.sp),
  zq60 = extract(zq60, Dagny.sp),
  zq70 = extract(zq70, Dagny.sp),
  zq80 = extract(zq80, Dagny.sp),
  zq90 = extract(zq90, Dagny.sp))


head(used.Dagny.df)
summary(used.Dagny.df)
dim(used.Dagny.df) 



#######################################
#Obtain some random points within mcp

random.points.Dagny <- spsample(Dagny.mcp, 83, "random")

#Calculate the covariates for the null set

avail.Dagny.df <- data.frame(
  used = rep(0, length(random.points.Dagny)),
  Species = rep("Mbra", length(Dagny.sp)),
  BatID = rep("Dagny", length(Dagny.sp)),
  zmax = extract(zmax, random.points.Dagny),
  zmean = extract(zmean, random.points.Dagny),
  zsd = extract(zsd, random.points.Dagny),
  zentropy = extract(zentropy, random.points.Dagny),
  pzabovezmean = extract(pzabovezmean, random.points.Dagny),
  pzabove0.5 = extract(pzabove0.5, random.points.Dagny),
  zq10 = extract(zq10, random.points.Dagny),
  zq20 = extract(zq20, random.points.Dagny),
  zq30 = extract(zq30, random.points.Dagny),
  zq40 = extract(zq40, random.points.Dagny),
  zq50 = extract(zq50, random.points.Dagny),
  zq60 = extract(zq60, random.points.Dagny),
  zq70 = extract(zq70, random.points.Dagny),
  zq80 = extract(zq80, random.points.Dagny),
  zq90 = extract(zq90, random.points.Dagny))


head(avail.Dagny.df)
summary(avail.Dagny.df)
dim(avail.Dagny.df)


#------Kaja

Kaja.locs <- subset(bat.locs, BatID == "Kaja")

#Determine available space (simplistically: MCP)
Kaja.mcp <- mcp(SpatialPoints(Kaja.locs), 95)
Kaja.mcp.xy <- Kaja.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Kaja.mcp.xy <- fortify(Kaja.mcp)


#Create data frame of covariates

names(Kaja.locs)

Kaja.sp<-SpatialPoints(Kaja.locs)


used.Kaja.df <- data.frame(
  used = rep(1, length(Kaja.sp)),
  Species = rep("Mbra", length(Kaja.sp)),
  BatID = rep("Kaja", length(Kaja.sp)),
  zmax = extract(zmax, Kaja.sp),
  zmean = extract(zmean, Kaja.sp),
  zsd = extract(zsd, Kaja.sp),
  zentropy = extract(zentropy, Kaja.sp),
  pzabovezmean = extract(pzabovezmean, Kaja.sp),
  pzabove0.5 = extract(pzabove0.5, Kaja.sp),
  zq10 = extract(zq10, Kaja.sp),
  zq20 = extract(zq20, Kaja.sp),
  zq30 = extract(zq30, Kaja.sp),
  zq40 = extract(zq40, Kaja.sp),
  zq50 = extract(zq50, Kaja.sp),
  zq60 = extract(zq60, Kaja.sp),
  zq70 = extract(zq70, Kaja.sp),
  zq80 = extract(zq80, Kaja.sp),
  zq90 = extract(zq90, Kaja.sp))


head(used.Kaja.df)
summary(used.Kaja.df)
dim(used.Kaja.df) 



#######################################
#Obtain some random points within mcp

random.points.Kaja <- spsample(Kaja.mcp, 91, "random")

#Calculate the covariates for the null set

avail.Kaja.df <- data.frame(
  used = rep(0, length(random.points.Kaja)),
  Species = rep("Mbra", length(Kaja.sp)),
  BatID = rep("Kaja", length(Kaja.sp)),
  zmax = extract(zmax, random.points.Kaja),
  zmean = extract(zmean, random.points.Kaja),
  zsd = extract(zsd, random.points.Kaja),
  zentropy = extract(zentropy, random.points.Kaja),
  pzabovezmean = extract(pzabovezmean, random.points.Kaja),
  pzabove0.5 = extract(pzabove0.5, random.points.Kaja),
  zq10 = extract(zq10, random.points.Kaja),
  zq20 = extract(zq20, random.points.Kaja),
  zq30 = extract(zq30, random.points.Kaja),
  zq40 = extract(zq40, random.points.Kaja),
  zq50 = extract(zq50, random.points.Kaja),
  zq60 = extract(zq60, random.points.Kaja),
  zq70 = extract(zq70, random.points.Kaja),
  zq80 = extract(zq80, random.points.Kaja),
  zq90 = extract(zq90, random.points.Kaja))

head(avail.Kaja.df)
summary(avail.Kaja.df)
dim(avail.Kaja.df)


#------Maren

Maren.locs <- subset(bat.locs, BatID == "Maren")

#Determine available space (simplistically: MCP)
Maren.mcp <- mcp(SpatialPoints(Maren.locs), 95)
Maren.mcp.xy <- Maren.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Maren.mcp.xy <- fortify(Maren.mcp)



#Create data frame of covariates

names(Maren.locs)

Maren.sp<-SpatialPoints(Maren.locs)


used.Maren.df <- data.frame(
  used = rep(1, length(Maren.sp)),
  Species = rep("Mbra", length(Maren.sp)),
  BatID = rep("Maren", length(Maren.sp)),
  zmax = extract(zmax, Maren.sp),
  zmean = extract(zmean, Maren.sp),
  zsd = extract(zsd, Maren.sp),
  zentropy = extract(zentropy, Maren.sp),
  pzabovezmean = extract(pzabovezmean, Maren.sp),
  pzabove0.5 = extract(pzabove0.5, Maren.sp),
  zq10 = extract(zq10, Maren.sp),
  zq20 = extract(zq20, Maren.sp),
  zq30 = extract(zq30, Maren.sp),
  zq40 = extract(zq40, Maren.sp),
  zq50 = extract(zq50, Maren.sp),
  zq60 = extract(zq60, Maren.sp),
  zq70 = extract(zq70, Maren.sp),
  zq80 = extract(zq80, Maren.sp),
  zq90 = extract(zq90, Maren.sp))

head(used.Maren.df)
summary(used.Maren.df)
dim(used.Maren.df) 



#######################################
#Obtain some random points within mcp

random.points.Maren <- spsample(Maren.mcp, 141, "random")

#Calculate the covariates for the null set

avail.Maren.df <- data.frame(
  used = rep(0, length(random.points.Maren)),
  Species = rep("Mbra", length(Maren.sp)),
  BatID = rep("Maren", length(Maren.sp)),
  zmax = extract(zmax, random.points.Maren),
  zmean = extract(zmean, random.points.Maren),
  zsd = extract(zsd, random.points.Maren),
  zentropy = extract(zentropy, random.points.Maren),
  pzabovezmean = extract(pzabovezmean, random.points.Maren),
  pzabove0.5 = extract(pzabove0.5, random.points.Maren),
  zq10 = extract(zq10, random.points.Maren),
  zq20 = extract(zq20, random.points.Maren),
  zq30 = extract(zq30, random.points.Maren),
  zq40 = extract(zq40, random.points.Maren),
  zq50 = extract(zq50, random.points.Maren),
  zq60 = extract(zq60, random.points.Maren),
  zq70 = extract(zq70, random.points.Maren),
  zq80 = extract(zq80, random.points.Maren),
  zq90 = extract(zq90, random.points.Maren))


head(avail.Maren.df)
summary(avail.Maren.df)
dim(avail.Maren.df)


#------Nora

Nora.locs <- subset(bat.locs, BatID == "Nora")

#Determine available space (simplistically: MCP)
Nora.mcp <- mcp(SpatialPoints(Nora.locs), 95)
Nora.mcp.xy <- Nora.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Nora.mcp.xy <- fortify(Nora.mcp)



#Create data frame of covariates

names(Nora.locs)

Nora.sp<-SpatialPoints(Nora.locs)


used.Nora.df <- data.frame(
  used = rep(1, length(Nora.sp)),
  Species = rep("Mbra", length(Nora.sp)),
  BatID = rep("Nora", length(Nora.sp)),
  zmax = extract(zmax, Nora.sp),
  zmean = extract(zmean, Nora.sp),
  zsd = extract(zsd, Nora.sp),
  zentropy = extract(zentropy, Nora.sp),
  pzabovezmean = extract(pzabovezmean, Nora.sp),
  pzabove0.5 = extract(pzabove0.5, Nora.sp),
  zq10 = extract(zq10, Nora.sp),
  zq20 = extract(zq20, Nora.sp),
  zq30 = extract(zq30, Nora.sp),
  zq40 = extract(zq40, Nora.sp),
  zq50 = extract(zq50, Nora.sp),
  zq60 = extract(zq60, Nora.sp),
  zq70 = extract(zq70, Nora.sp),
  zq80 = extract(zq80, Nora.sp),
  zq90 = extract(zq90, Nora.sp))

head(used.Nora.df)
summary(used.Nora.df)
dim(used.Nora.df) 



#######################################
#Obtain some random points within mcp

random.points.Nora <- spsample(Nora.mcp, 49, "random")

#Calculate the covariates for the null set

avail.Nora.df <- data.frame(
  used = rep(0, length(random.points.Nora)),
  Species = rep("Mbra", length(Nora.sp)),
  BatID = rep("Nora", length(Nora.sp)),
  zmax = extract(zmax, random.points.Nora),
  zmean = extract(zmean, random.points.Nora),
  zsd = extract(zsd, random.points.Nora),
  zentropy = extract(zentropy, random.points.Nora),
  pzabovezmean = extract(pzabovezmean, random.points.Nora),
  pzabove0.5 = extract(pzabove0.5, random.points.Nora),
  zq10 = extract(zq10, random.points.Nora),
  zq20 = extract(zq20, random.points.Nora),
  zq30 = extract(zq30, random.points.Nora),
  zq40 = extract(zq40, random.points.Nora),
  zq50 = extract(zq50, random.points.Nora),
  zq60 = extract(zq60, random.points.Nora),
  zq70 = extract(zq70, random.points.Nora),
  zq80 = extract(zq80, random.points.Nora),
  zq90 = extract(zq90, random.points.Nora))

head(avail.Nora.df)
summary(avail.Nora.df)
dim(avail.Nora.df)


#------Phoebe

Phoebe.locs <- subset(bat.locs, BatID == "Phoebe")

#Determine available space (simplistically: MCP)
Phoebe.mcp <- mcp(SpatialPoints(Phoebe.locs), 95)
Phoebe.mcp.xy <- Phoebe.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Phoebe.mcp.xy <- fortify(Phoebe.mcp)



#Create data frame of covariates

names(Phoebe.locs)

Phoebe.sp<-SpatialPoints(Phoebe.locs)


used.Phoebe.df <- data.frame(
  used = rep(1, length(Phoebe.sp)),
  Species = rep("Mbra", length(Phoebe.sp)),
  BatID = rep("Phoebe", length(Phoebe.sp)),
  zmax = extract(zmax, Phoebe.sp),
  zmean = extract(zmean, Phoebe.sp),
  zsd = extract(zsd, Phoebe.sp),
  zentropy = extract(zentropy, Phoebe.sp),
  pzabovezmean = extract(pzabovezmean, Phoebe.sp),
  pzabove0.5 = extract(pzabove0.5, Phoebe.sp),
  zq10 = extract(zq10, Phoebe.sp),
  zq20 = extract(zq20, Phoebe.sp),
  zq30 = extract(zq30, Phoebe.sp),
  zq40 = extract(zq40, Phoebe.sp),
  zq50 = extract(zq50, Phoebe.sp),
  zq60 = extract(zq60, Phoebe.sp),
  zq70 = extract(zq70, Phoebe.sp),
  zq80 = extract(zq80, Phoebe.sp),
  zq90 = extract(zq90, Phoebe.sp))


head(used.Phoebe.df)
summary(used.Phoebe.df)
dim(used.Phoebe.df) 



#######################################
#Obtain some random points within mcp

random.points.Phoebe <- spsample(Phoebe.mcp, 62, "random")

#Calculate the covariates for the null set

avail.Phoebe.df <- data.frame(
  used = rep(0, length(random.points.Phoebe)),
  Species = rep("Mbra", length(Phoebe.sp)),
  BatID = rep("Phoebe", length(Phoebe.sp)),
  zmax = extract(zmax, random.points.Phoebe),
  zmean = extract(zmean, random.points.Phoebe),
  zsd = extract(zsd, random.points.Phoebe),
  zentropy = extract(zentropy, random.points.Phoebe),
  pzabovezmean = extract(pzabovezmean, random.points.Phoebe),
  pzabove0.5 = extract(pzabove0.5, random.points.Phoebe),
  zq10 = extract(zq10, random.points.Phoebe),
  zq20 = extract(zq20, random.points.Phoebe),
  zq30 = extract(zq30, random.points.Phoebe),
  zq40 = extract(zq40, random.points.Phoebe),
  zq50 = extract(zq50, random.points.Phoebe),
  zq60 = extract(zq60, random.points.Phoebe),
  zq70 = extract(zq70, random.points.Phoebe),
  zq80 = extract(zq80, random.points.Phoebe),
  zq90 = extract(zq90, random.points.Phoebe))

head(avail.Phoebe.df)
summary(avail.Phoebe.df)
dim(avail.Phoebe.df)


#------Sofia

Sofia.locs <- subset(bat.locs, BatID == "Sofia")

#Determine available space (simplistically: MCP)
Sofia.mcp <- mcp(SpatialPoints(Sofia.locs), 95)
Sofia.mcp.xy <- Sofia.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Sofia.mcp.xy <- fortify(Sofia.mcp)



#Create data frame of covariates

names(Sofia.locs)

Sofia.sp<-SpatialPoints(Sofia.locs)


used.Sofia.df <- data.frame(
  used = rep(1, length(Sofia.sp)),
  Species = rep("Mbra", length(Sofia.sp)),
  BatID = rep("Sofia", length(Sofia.sp)),
  zmax = extract(zmax, Sofia.sp),
  zmean = extract(zmean, Sofia.sp),
  zsd = extract(zsd, Sofia.sp),
  zentropy = extract(zentropy, Sofia.sp),
  pzabovezmean = extract(pzabovezmean, Sofia.sp),
  pzabove0.5 = extract(pzabove0.5, Sofia.sp),
  zq10 = extract(zq10, Sofia.sp),
  zq20 = extract(zq20, Sofia.sp),
  zq30 = extract(zq30, Sofia.sp),
  zq40 = extract(zq40, Sofia.sp),
  zq50 = extract(zq50, Sofia.sp),
  zq60 = extract(zq60, Sofia.sp),
  zq70 = extract(zq70, Sofia.sp),
  zq80 = extract(zq80, Sofia.sp),
  zq90 = extract(zq90, Sofia.sp))


head(used.Sofia.df)
summary(used.Sofia.df)
dim(used.Sofia.df) 



#######################################
#Obtain some random points within mcp

random.points.Sofia <- spsample(Sofia.mcp, 39, "random")

#Calculate the covariates for the null set

avail.Sofia.df <- data.frame(
  used = rep(0, length(random.points.Sofia)),
  Species = rep("Mbra", length(Sofia.sp)),
  BatID = rep("Sofia", length(Sofia.sp)),
  zmax = extract(zmax, random.points.Sofia),
  zmean = extract(zmean, random.points.Sofia),
  zsd = extract(zsd, random.points.Sofia),
  zentropy = extract(zentropy, random.points.Sofia),
  pzabovezmean = extract(pzabovezmean, random.points.Sofia),
  pzabove0.5 = extract(pzabove0.5, random.points.Sofia),
  zq10 = extract(zq10, random.points.Sofia),
  zq20 = extract(zq20, random.points.Sofia),
  zq30 = extract(zq30, random.points.Sofia),
  zq40 = extract(zq40, random.points.Sofia),
  zq50 = extract(zq50, random.points.Sofia),
  zq60 = extract(zq60, random.points.Sofia),
  zq70 = extract(zq70, random.points.Sofia),
  zq80 = extract(zq80, random.points.Sofia),
  zq90 = extract(zq90, random.points.Sofia))



head(avail.Sofia.df)
summary(avail.Sofia.df)
dim(avail.Sofia.df)


#------Steffi

Steffi.locs <- subset(bat.locs, BatID == "Steffi")

#Determine available space (simplistically: MCP)
Steffi.mcp <- mcp(SpatialPoints(Steffi.locs), 95)
Steffi.mcp.xy <- Steffi.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Steffi.mcp.xy <- fortify(Steffi.mcp)



#Create data frame of covariates

names(Steffi.locs)

Steffi.sp<-SpatialPoints(Steffi.locs)


used.Steffi.df <- data.frame(
  used = rep(1, length(Steffi.sp)),
  Species = rep("Mbra", length(Steffi.sp)),
  BatID = rep("Steffi", length(Steffi.sp)),
  zmax = extract(zmax, Steffi.sp),
  zmean = extract(zmean, Steffi.sp),
  zsd = extract(zsd, Steffi.sp),
  zentropy = extract(zentropy, Steffi.sp),
  pzabovezmean = extract(pzabovezmean, Steffi.sp),
  pzabove0.5 = extract(pzabove0.5, Steffi.sp),
  zq10 = extract(zq10, Steffi.sp),
  zq20 = extract(zq20, Steffi.sp),
  zq30 = extract(zq30, Steffi.sp),
  zq40 = extract(zq40, Steffi.sp),
  zq50 = extract(zq50, Steffi.sp),
  zq60 = extract(zq60, Steffi.sp),
  zq70 = extract(zq70, Steffi.sp),
  zq80 = extract(zq80, Steffi.sp),
  zq90 = extract(zq90, Steffi.sp))

head(used.Steffi.df)
summary(used.Steffi.df)
dim(used.Steffi.df) 



#######################################
#Obtain some random points within mcp

random.points.Steffi <- spsample(Steffi.mcp, 39, "random")

#Calculate the covariates for the null set

avail.Steffi.df <- data.frame(
  used = rep(0, length(random.points.Steffi)),
  Species = rep("Mbra", length(Steffi.sp)),
  BatID = rep("Steffi", length(Steffi.sp)),
  zmax = extract(zmax, random.points.Steffi),
  zmean = extract(zmean, random.points.Steffi),
  zsd = extract(zsd, random.points.Steffi),
  zentropy = extract(zentropy, random.points.Steffi),
  pzabovezmean = extract(pzabovezmean, random.points.Steffi),
  pzabove0.5 = extract(pzabove0.5, random.points.Steffi),
  zq10 = extract(zq10, random.points.Steffi),
  zq20 = extract(zq20, random.points.Steffi),
  zq30 = extract(zq30, random.points.Steffi),
  zq40 = extract(zq40, random.points.Steffi),
  zq50 = extract(zq50, random.points.Steffi),
  zq60 = extract(zq60, random.points.Steffi),
  zq70 = extract(zq70, random.points.Steffi),
  zq80 = extract(zq80, random.points.Steffi),
  zq90 = extract(zq90, random.points.Steffi))

head(avail.Steffi.df)
summary(avail.Steffi.df)
dim(avail.Steffi.df)


#------Thea

Thea.locs <- subset(bat.locs, BatID == "Thea")

#Determine available space (simplistically: MCP)
Thea.mcp <- mcp(SpatialPoints(Thea.locs), 95)
Thea.mcp.xy <- Thea.mcp@polygons[[1]]@Polygons[[1]]@coords

# FORTIYFY
require(ggplot2)
Thea.mcp.xy <- fortify(Thea.mcp)



#Create data frame of covariates

names(Thea.locs)

Thea.sp<-SpatialPoints(Thea.locs)


used.Thea.df <- data.frame(
  used = rep(1, length(Thea.sp)),
  Species = rep("Mbra", length(Thea.sp)),
  BatID = rep("Thea", length(Thea.sp)),
  zmax = extract(zmax, Thea.sp),
  zmean = extract(zmean, Thea.sp),
  zsd = extract(zsd, Thea.sp),
  zentropy = extract(zentropy, Thea.sp),
  pzabovezmean = extract(pzabovezmean, Thea.sp),
  pzabove0.5 = extract(pzabove0.5, Thea.sp),
  zq10 = extract(zq10, Thea.sp),
  zq20 = extract(zq20, Thea.sp),
  zq30 = extract(zq30, Thea.sp),
  zq40 = extract(zq40, Thea.sp),
  zq50 = extract(zq50, Thea.sp),
  zq60 = extract(zq60, Thea.sp),
  zq70 = extract(zq70, Thea.sp),
  zq80 = extract(zq80, Thea.sp),
  zq90 = extract(zq90, Thea.sp))


head(used.Thea.df)
summary(used.Thea.df)
dim(used.Thea.df) 



#######################################
#Obtain some random points within mcp

random.points.Thea <- spsample(Thea.mcp, 101, "random")

#Calculate the covariates for the null set

avail.Thea.df <- data.frame(
  used = rep(0, length(random.points.Thea)),
  Species = rep("Mbra", length(Thea.sp)),
  BatID = rep("Thea", length(Thea.sp)),
  zmax = extract(zmax, random.points.Thea),
  zmean = extract(zmean, random.points.Thea),
  zsd = extract(zsd, random.points.Thea),
  zentropy = extract(zentropy, random.points.Thea),
  pzabovezmean = extract(pzabovezmean, random.points.Thea),
  pzabove0.5 = extract(pzabove0.5, random.points.Thea),
  zq10 = extract(zq10, random.points.Thea),
  zq20 = extract(zq20, random.points.Thea),
  zq30 = extract(zq30, random.points.Thea),
  zq40 = extract(zq40, random.points.Thea),
  zq50 = extract(zq50, random.points.Thea),
  zq60 = extract(zq60, random.points.Thea),
  zq70 = extract(zq70, random.points.Thea),
  zq80 = extract(zq80, random.points.Thea),
  zq90 = extract(zq90, random.points.Thea))



head(avail.Thea.df)
summary(avail.Thea.df)
dim(avail.Thea.df)

###################
###################

#--------------zmax 16 plots pooled MCPs for each species
#windows()
plot(zmax)
lines(Amelia.mcp, col="darkred", lwd=2)
lines(Aricia.mcp, col="darkred", lwd=2)
lines(Daisy.mcp, col="darkred", lwd=2)
lines(Ethel.mcp, col="darkred", lwd=2)
lines(Ida.mcp, col="darkred", lwd=2)
lines(Line.mcp, col="darkred", lwd=2)
lines(Louise.mcp, col="darkred", lwd=2)
lines(Marie.mcp, col="darkred", lwd=2)
lines(Ragnhild.mcp, col="darkred", lwd=2)
lines(Reeda.mcp, col="darkred", lwd=2)
lines(Stine.mcp, col="darkred", lwd=2)
lines(Turid.mcp, col="darkred", lwd=2)
mtext("95% MCP M. mystacinus zmax16")

#windows()
plot(zmax)
lines(Astrid.mcp, col="blue", lwd=2)
lines(Dagny.mcp, col="blue", lwd=2)
lines(Kaja.mcp, col="blue", lwd=2)
lines(Maren.mcp, col="blue", lwd=2)
lines(Nora.mcp, col="blue", lwd=2)
lines(Phoebe.mcp, col="blue", lwd=2)
lines(Sofia.mcp, col="blue", lwd=2)
lines(Steffi.mcp, col="blue", lwd=2)
lines(Thea.mcp, col="blue", lwd=2)
mtext("95% MCP M. brandtii zmax16")


#################################
#################################

#Combine used data for all Mbra individuals
Mbra.data.used <- rbind(
  used.Astrid.df,
  used.Dagny.df,
  used.Kaja.df,
  used.Maren.df,
  used.Nora.df,
  used.Phoebe.df,
  used.Sofia.df,
  used.Steffi.df,
  used.Thea.df)
head(Mbra.data.used)
summary(Mbra.data.used)
dim(Mbra.data.used)
table(Mbra.data.used$BatID)

# Astrid  Dagny   Kaja  Maren   Nora Phoebe  Sofia Steffi   Thea 
#     81     83     91    141     49     62     39     39    101 

#Combine available data for all Mbra individuals
Mbra.data.avail <- rbind(
  avail.Astrid.df, 
  avail.Dagny.df, 
  avail.Kaja.df, 
  avail.Maren.df, 
  avail.Nora.df, 
  avail.Phoebe.df, 
  avail.Sofia.df, 
  avail.Steffi.df, 
  avail.Thea.df)
head(Mbra.data.avail)
summary(Mbra.data.avail)
dim(Mbra.data.avail)
table(Mbra.data.avail$BatID)

# Astrid  Dagny   Kaja  Maren   Nora Phoebe  Sofia Steffi   Thea 
#     81     83     91    141     49     62     39     39    101 


#Combine Used and Avilable data for all Mbra individuals
Mbra.data <- rbind(Mbra.data.used, Mbra.data.avail)
head(Mbra.data)
summary(Mbra.data)
dim(Mbra.data)
table(Mbra.data$BatID)

# Astrid  Dagny   Kaja  Maren   Nora Phoebe  Sofia Steffi   Thea 
#    162    166    182    282     98    124     78     78    202 

#####################################################
#####################################################


#Combine Used and Avilable data for all Mmys and Mbra individuals
Bats.data <- rbind(Mmys.data, Mbra.data)
head(Bats.data)
summary(Bats.data) #There are a few NA's in the lidar data - not sure why and how it affects results - look into this later
dim(Bats.data)
#[1] 3004   18

Bats.data.used <- subset(Bats.data, used == "1")
Bats.data.avail <- subset(Bats.data, used == "0")

dim(Bats.data.used)
#[1] 1502   18
dim(Bats.data.avail)
#[1] 1502   18

#I am going to export this as a csv file to look at the NAs
#write.table(Bats.data, file = file.path(output_today,"Bats_data_incl_NA_16.csv")) 
summary(Bats.data)
subBats.data = subset(Bats.data, select = -c(zentropy) ) #1429 (earlier 1400) observations had NA for zentropy
dim(subBats.data)
#[1] 3004   17

data_16 <- na.omit(subBats.data)

dim(data_16)
# 2976
# Now 2978 ... 
data_16$Species <- as.factor(data_16$Species)
data_16$BatID <- as.factor(data_16$BatID)
summary(data_16)
dim(data_16)
# Previously: Previously (2020): 2970   1   #More observations had to be deleted because of NAs for res16 than for res250

## This is now 2974 .... 

#write.csv(data_16, "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Spatial and Morphology/Inputs/data_95MCP16_2023.csv")

data_16.used <- subset(data_16, used == "1")
data_16.avail <- subset(data_16, used == "0")

dim(data_16.used)
#[1] 1478   17
dim(data_16.avail)
#[1] 1492   17
# Now 1496   17

#I am going to export this as a csv file so that you can run RSFs later without going through all the previous code
# write.table(data_16, file = file.path(output_today, "data_95MCP16_excl_zentropy.csv") ) 

#Summarizing home ranges 

B_MCP<-rbind.SpatialLinesDataFrame(Astrid.mcp, Dagny.mcp, Kaja.mcp, Maren.mcp, Nora.mcp, Phoebe.mcp, Sofia.mcp, Steffi.mcp, Thea.mcp)

summary(B_MCP)                                     

#id         area        

#a:9   Min.   :  3.469  

#1st Qu.: 44.678  

#Median : 74.171  

#Mean   : 85.829  

#3rd Qu.:129.038  

#Max.   :189.216  


M_MCP<-rbind.SpatialLinesDataFrame(Amelia.mcp, Aricia.mcp, Daisy.mcp,
                                   
                                   Ethel.mcp, Ida.mcp, Louise.mcp, Marie.mcp, 
                                   
                                   Ragnhild.mcp, Reeda.mcp, Stine.mcp, Turid.mcp)

summary(M_MCP)

#id          area        

#a:11   Min.   : 0.5285  

#1st Qu.: 5.9367  

#Median :20.3423  

#Mean   :24.9797  

#3rd Qu.:36.4684  

#Max.   :72.8878 


#B_MCP and M_MCP combined: 
# tot_mcp <- rbind.SpatialLinesDataFrame(M_MCP, B_MCP)
# plot(tot_mcp)
# 
# tot_mcp <- as.data.frame(tot_mcp) # then you lose the individual ID.
.. 

plot(B_MCP)
plot(M_MCP)

```

## Visualizing the mcps 
```{r}
library(lattice)
library(leafpop)
library(mapview)
library(vapoRwave)
library(viridis)

Species.col<- c("blue","black")
names(Species.col)<-levels(Bats45$Species)
plot(Bats45, col = Species.col[Bats45$Species],pch=20, cex=0.5)

BatID.col<- c("red","gold","blue",
              "tomato","sienna1","indianred",
              "orangered","lightseagreen","orangered3",
              "lightcoral","cornflowerblue","salmon4",
              "cyan","brown1","brown4","chocolate1",
              "skyblue","steelblue4","darkgoldenrod1",
              "azure","brown3")

# MBRA and MMYS home ranges 
temp <- Bats45
temp@data <- data.frame(id = Bats45@data$Species)#--
Bats45.mcp <- mcp(temp, percent = 95)
plot(Bats45, col = Species.col[Bats45$Species],pch=20, cex=0.5)
plot(Bats45.mcp, border = adjustcolor(Species.col), col = adjustcolor(Species.col, alpha = 0.3), add = TRUE)

# Each bats home range 
temp <- Bats45
temp@data <- data.frame(id = Bats45@data$BatID)#---
Bats.mcp <- mcp(temp, percent = 95)
plot(Bats45, col = BatID.col[Bats45$BatID], pch=20, cex=0.5)
plot(Bats.mcp, border = adjustcolor(BatID.col), col = adjustcolor(BatID.col, alpha = 0.3), add = TRUE)


## Export Bats45 and Bats45.mcp as geopackages so you can do this step alone without recreating all this if you want to: 
sBats45 <- st_as_sf(Bats45, crs = "+proj=utm + zone=32 + datum=WGS84 + units=m + no_defs")
plot(sBats45)
mapview(sBats45) # This works! 
#st_write(sBats45, "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Outputs/Spatialpt1_2023-09-15/AllBats45IndvidualPoints.gpkg", driver = "GPKG")
 
sBats45.mcp <- st_as_sf(Bats45.mcp, crs = "+proj=utm + zone=32 + datum=WGS84 + units=m + no_defs")
mapview(sBats45.mcp)
#st_write(sBats45, "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Outputs/Spatialpt1_2023-09-15/EachSpeciesMCP_crs.gpkg", driver = "GPKG")

sBats.mcp <- st_as_sf(Bats.mcp, crs = "+proj=utm + zone=32 + datum=WGS84 + units=m + no_defs")
M <- mapview(sBats.mcp, zcol = "id")
mapshot( M,
  url = "EachBatMCP.html",
  file = NULL,
  remove_controls = c("zoomControl", "layersControl", "homeButton", "scaleBar",
    "drawToolbar", "easyButton"))
st_write(sBats45, "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Outputs/Spatialpt1_2023-09-15/EachBatMCP.gpkg", driver = "GPKG")

# for examples of how to map spatial data in library(ggmap):
#   https://jamesepaterson.github.io/jamespatersonblog/03_trackingworkshop_homeranges
```



```{r}

## Need to recreate this dataset - not clear when / When it was made from exisitng scripts. 
# mcp.all<-read.csv("C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Spatial and Morphology/Inputs/mcp_total.csv", header=TRUE) 
# dim(mcp.all)
# # 21 4
# head(mcp.all)
#       id     area   fSpecies obs
# 1 Amelia  4.60285 MYSTACINUS  16
# 2 Aricia 26.46360 MYSTACINUS  90
# 3  Daisy 10.28550 MYSTACINUS 134
# 4  Ethel 72.88780 MYSTACINUS 117
# 5    Ida 46.47320 MYSTACINUS 119
# 6 Louise 26.07665 MYSTACINUS  64
# summary(mcp.all)
 #      id                 area            fSpecies              obs        
 # Length:21          Min.   :  0.5285   Length:21          Min.   :  8.00  
 # Class :character   1st Qu.: 10.2855   Class :character   1st Qu.: 39.00  
 # Mode  :character   Median : 35.1854   Mode  :character   Median : 70.00  
 #                    Mean   : 50.5142                      Mean   : 71.52  
 #                    3rd Qu.: 72.8878                      3rd Qu.: 91.00  
 #                    Max.   :189.2164                      Max.   :141.00 

# Create mcp.all data object 

## Brandtii first 
Astrid.mcp.df <- as.data.frame(Astrid.mcp) 
Astrid.mcp.df$id <- "Astrid"
Astrid.mcp.df$fSpecies <- "BRANDTII"

Dagny.mcp.df <- as.data.frame(Dagny.mcp) 
Dagny.mcp.df$id <- "Dagny"
Dagny.mcp.df$fSpecies <- "BRANDTII"

Kaja.mcp.df <- as.data.frame(Kaja.mcp) 
Kaja.mcp.df$id <- "Kaja"
Kaja.mcp.df$fSpecies <- "BRANDTII"

Maren.mcp.df <- as.data.frame(Maren.mcp) 
Maren.mcp.df$id <- "Maren"
Maren.mcp.df$fSpecies <- "BRANDTII"

Nora.mcp.df <- as.data.frame(Nora.mcp) 
Nora.mcp.df$id <- "Nora"
Nora.mcp.df$fSpecies <- "BRANDTII"

Phoebe.mcp.df <- as.data.frame(Phoebe.mcp) 
Phoebe.mcp.df$id <- "Phoebe"
Phoebe.mcp.df$fSpecies <- "BRANDTII"

Sofia.mcp.df <- as.data.frame(Sofia.mcp) 
Sofia.mcp.df$id <- "Sofia"
Sofia.mcp.df$fSpecies <- "BRANDTII"

Steffi.mcp.df <- as.data.frame(Steffi.mcp) 
Steffi.mcp.df$id <- "Steffi"
Steffi.mcp.df$fSpecies <- "BRANDTII"

Thea.mcp.df <- as.data.frame(Thea.mcp) 
Thea.mcp.df$id <- "Thea"
Thea.mcp.df$fSpecies <- "BRANDTII"

### Now Mystacinus 

Amelia.mcp.df <- as.data.frame(Amelia.mcp) 
Amelia.mcp.df$id <- "Amelia"
Amelia.mcp.df$fSpecies <- "MYSTACINUS"

Aricia.mcp.df <- as.data.frame(Aricia.mcp) 
Aricia.mcp.df$id <- "Aricia"
Aricia.mcp.df$fSpecies <- "MYSTACINUS"

Daisy.mcp.df <- as.data.frame(Daisy.mcp) 
Daisy.mcp.df$id <- "Daisy"
Daisy.mcp.df$fSpecies <- "MYSTACINUS"

Ethel.mcp.df <- as.data.frame(Ethel.mcp) 
Ethel.mcp.df$id <- "Ethel"
Ethel.mcp.df$fSpecies <- "MYSTACINUS"

Ida.mcp.df <- as.data.frame(Ida.mcp) 
Ida.mcp.df$id <- "Ida"
Ida.mcp.df$fSpecies <- "MYSTACINUS"

Louise.mcp.df <- as.data.frame(Louise.mcp) 
Louise.mcp.df$id <- "Louise"
Louise.mcp.df$fSpecies <- "MYSTACINUS"

Line.mcp.df <- as.data.frame(Line.mcp) 
Line.mcp.df$id <- "Line"
Line.mcp.df$fSpecies <- "MYSTACINUS"

Marie.mcp.df <- as.data.frame(Marie.mcp) 
Marie.mcp.df$id <- "Marie"
Marie.mcp.df$fSpecies <- "MYSTACINUS"

Ragnhild.mcp.df <- as.data.frame(Ragnhild.mcp) 
Ragnhild.mcp.df$id <- "Ragnhild"
Ragnhild.mcp.df$fSpecies <- "MYSTACINUS"

Reeda.mcp.df <- as.data.frame(Reeda.mcp) 
Reeda.mcp.df$id <- "Reeda"
Reeda.mcp.df$fSpecies <- "MYSTACINUS"

Stine.mcp.df <- as.data.frame(Stine.mcp) 
Stine.mcp.df$id <- "Stine"
Stine.mcp.df$fSpecies <- "MYSTACINUS"

Turid.mcp.df <- as.data.frame(Turid.mcp) 
Turid.mcp.df$id <- "Turid"
Turid.mcp.df$fSpecies <- "MYSTACINUS"

allbats <- list(Astrid.mcp.df, Dagny.mcp.df, Kaja.mcp.df, 
                        Maren.mcp.df, Nora.mcp.df, Phoebe.mcp.df, 
                        Sofia.mcp.df, Steffi.mcp.df, Thea.mcp.df,
                        Amelia.mcp.df, Aricia.mcp.df, Daisy.mcp.df,
                        Ethel.mcp.df, Ida.mcp.df, Louise.mcp.df, 
                        Line.mcp.df, Marie.mcp.df, Ragnhild.mcp.df, 
                        Reeda.mcp.df, Stine.mcp.df, Turid.mcp.df)
head(allbats)

mcp.df.all1 <- allbats %>% reduce(full_join, by= c('id','area', 'fSpecies')) 


head(mcp.df.all1) # Looking good! Just need to save the number of observations and add those. 
#        id      area fSpecies
# 1  Astrid 189.21635 BRANDTII
# 2  Dagny   56.82605 BRANDTII
# 3   Kaja    3.46870 BRANDTII
# 4  Maren   35.18540 BRANDTII
# 5   Nora  129.03770 BRANDTII
# 6 Phoebe  154.08315 BRANDTII

bat.locs1 <- as.data.frame(bat.locs) # 1502 obs of 13 vars

sumobs <- bat.locs1 %>% group_by(BatID) %>% dplyr::summarize(obs = sum(n()))
head(sumobs)
#   BatID    obs
#   <fct>  <int>
# 1 Amelia    16
# 2 Aricia    90
# 3 Astrid    81
# 4 Dagny     83
# 5 Daisy    134
# 6 Ethel    117

summary(sumobs)
 #     BatID         obs        
 # Amelia : 1   Min.   :  8.00  
 # Aricia : 1   1st Qu.: 39.00  
 # Astrid : 1   Median : 70.00  
 # Dagny  : 1   Mean   : 71.52  
 # Daisy  : 1   3rd Qu.: 91.00  
 # Ethel  : 1   Max.   :141.00  

mcp.df.all1$BatID <- as.factor(mcp.df.all1$id ) # Make a common column for joining
mcp.df.all1 <- mcp.df.all1 %>% select(-id)
mcp.df.all1 <- as_tibble(mcp.df.all1)

summary(mcp.df.all1)
head(mcp.df.all1)
# # A tibble: 6 x 3
#     area fSpecies BatID    
#    <dbl> <chr>    <fct>    
# 1 189.   BRANDTII "Astrid" 
# 2  56.8  BRANDTII "Dagny " 
# 3   3.47 BRANDTII "Kaja "  
# 4  35.2  BRANDTII "Maren " 
# 5 129.   BRANDTII "Nora "  
# 6 154.   BRANDTII "Phoebe "



mcp.all2 <- dplyr::full_join(mcp.df.all1, sumobs, keep=TRUE )
head(mcp.all2)
## Did I manage to recreate the mcp.all dataset? 


# hr<-area$mcp.all~lm(fSpecies+obs,data=mcp.all)
# summary(hr)
# # Length   Class    Mode 
# # 3 formula    call 
# 
# lm1<-lm(area~fSpecies+obs,data=mcp.all)
# summary(lm1)
# 
# # Residuals:
# #    Min     1Q Median     3Q    Max 
# # -82.16 -22.25 -10.65  23.15 103.45 
# # 
# # Coefficients:
# #                     Estimate Std. Error t value Pr(>|t|)   
# # (Intercept)         86.87963   24.89248   3.490  0.00261 **
# # fSpeciesMYSTACINUS -61.91432   19.64918  -3.151  0.00553 **
# # obs                 -0.01378    0.26294  -0.052  0.95877   
# # ---
# # Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# # 
# # Residual standard error: 44.29 on 18 degrees of freedom
# # Multiple R-squared:  0.3575,	Adjusted R-squared:  0.2861 
# # F-statistic: 5.008 on 2 and 18 DF,  p-value: 0.01865

lmtest <- lm(area~fSpecies+obs,data=mcp.all2)
summary(lmtest)

# 
# Residuals:
#    Min     1Q Median     3Q    Max 
# -82.16 -22.25 -10.65  23.15 103.45 
# 
# Coefficients:
#                     Estimate Std. Error t value Pr(>|t|)   
# (Intercept)         86.87963   24.89248   3.490  0.00261 **
# fSpeciesMYSTACINUS -61.91432   19.64918  -3.151  0.00553 **
# obs                 -0.01378    0.26294  -0.052  0.95877   
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
# 
# Residual standard error: 44.29 on 18 degrees of freedom
# Multiple R-squared:  0.3575,	Adjusted R-squared:  0.2861 
# F-statistic: 5.008 on 2 and 18 DF,  p-value: 0.01865


## That worked! 

#write.csv(mcp.all2, file = file.path(output_today, "mcp.all.2023.csv"))
output_today
# "C:/Users/apmc/OneDrive - Norwegian University of Life Sciences/1. Nittedal 2018-2020/Nittedal_Main/Analyses/Outputs/Spatialpt1_2023-09-15/mcp.all.2023.csv"

lm2<-lm(area~fSpecies*obs,data=mcp.all2)
summary(lm2)

#Coefficients:
#  Estimate Std. Error t value Pr(>|t|)    
#(Intercept)             145.7897    35.4146   4.117  0.00072 ***
#  fSpeciesMYSTACINUS     -144.5000    42.1269  -3.430  0.00319 ** 
#  obs                      -0.7867     0.4298  -1.830  0.08481 .  
#fSpeciesMYSTACINUS:obs    1.1210     0.5177   2.166  0.04485 *  


drop1(lm1, test="Chi")
# Single term deletions
# 
# Model:
# area ~ fSpecies + obs
#          Df Sum of Sq   RSS    AIC Pr(>Chi)   
# <none>                35308 161.97            
# fSpecies  1   19475.9 54784 169.20 0.002387 **
# obs       1       5.4 35314 159.98 0.954848   
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
drop1(lm2, test="Chi")
# Single term deletions
# 
# Model:
# area ~ fSpecies * obs
#              Df Sum of Sq   RSS    AIC Pr(>Chi)  
# <none>                    27674 158.86           
# fSpecies:obs  1    7634.5 35308 161.97   0.0237 *
# ---
# Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

# Does not plot... 
# plot(area~ fSpecies+obs, data=mcp.all)

# Violin plot of the different area covered for each species 
v<-ggplot(mcp.all, aes(x=fSpecies, y=area, fill=fSpecies)) + 
  geom_violin(trim=FALSE) + 
  labs(x = " ", y = " ")+
  theme(axis.text.x=element_blank()) +
  geom_boxplot(width=0.1) +
  theme(legend.position="none")
v

m <- mcp.all %>% mutate(fSpecies = as.factor(fSpecies)) %>% filter(fSpecies == "MYSTACINUS") %>% droplevels() 
summary(m$area)
 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 # 0.5285  6.6036 16.9507 24.0280 31.4660 72.8878 

b <- mcp.all %>% mutate(fSpecies = as.factor(fSpecies)) %>% filter(fSpecies == "BRANDTII") %>% droplevels() 
summary(b$area)
  #  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  # 3.469  44.678  74.171  85.829 129.038 189.216 

mcp.all$fSpecies <- as.factor(mcp.all$fSpecies)
str(mcp.all)
summary(mcp.all)
 #      id                 area                fSpecies       obs        
 # Length:21          Min.   :  0.5285   BRANDTII  : 9   Min.   :  8.00  
 # Class :character   1st Qu.: 10.2855   MYSTACINUS:12   1st Qu.: 39.00  
 # Mode  :character   Median : 35.1854                   Median : 70.00  
 #                    Mean   : 50.5142                   Mean   : 71.52  
 #                    3rd Qu.: 72.8878                   3rd Qu.: 91.00  
 #                    Max.   :189.2164                   Max.   :141.00 
```




```{r}

boxplot(area ~ fSpecies, strip = strip.custom(bg = 'white'),
        cex = .5,
        data = mcp.all,
        ylab = " ",
        xlab = "Species", 
        names = c("M. brandtii", "M. mystacinus"),
        col = c("indianred1", "turquoise3")
        ) 

plot(area~ fSpecies+obs, data=mcp.all)



#plotting the predicted response 
library(Lahman)
if (require("Lahman")) {
  # Find 3 bats with larges home range
  tibble::as_tibble(mcp.all) %>%
    group_by(id) %>%
    tally(area) %>%
    top_n(3) 
}

#1 Astrid  189.
#2 Nora    129.
#3 Phoebe  154.

lm2<-lm(area~fSpecies-obs,data=mcp.all)

library(units)

tp <- ggplot(mcp.all, aes(x=obs, y=area, col=fSpecies)) + geom_point() + ylab("area") + geom_smooth(method=lm, se=FALSE, fullrange=TRUE) 


tp 


```

